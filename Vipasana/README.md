<b>1- The main function</b></br>
start with copying 3 RSA public keys into 3 seperate variables and obfuscating them with concatenating something like 13G13G....</br> 
There is 3 blocks of code like this , each one for an RSA key  
```C
copy(
    (volatile signed __int32 *)&RSA_KEY_1,
    (signed __int32)"8218573558423868576763286162417727488729356553874144436243558385082013292018314269999051321143121835"
                    "1515869551667585525921751268860153332622085268097015158687030691773886056780852269841267506558244411");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "03484117901192362044107373706299647832760503989379610949620903289961076922047235709569442148351776390771045819406380"
    "727053579573045429371687056037657759416374532634792426441798055715624726414878656648");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "97932057208863804097317380182557626120092371160971366025152017122881832224591456521412041436352424715545408606242333"
    "615724802894715060374899930748348693104568782083465816005355018530243731351021765414");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "1746100718072807:65537|||13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G1"
    "3G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G13G1");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G1"
    "4G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G14G1");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G1"
    "5G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G15G1");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G1"
    "6G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G16G1");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G1"
    "7G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G17G1");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G1"
    "8G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G18G1");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G1"
    "9G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G19G1");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110"
    "G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110G110");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111"
    "G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111G111");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112"
    "G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112G112");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113"
    "G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113G113");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114"
    "G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114G114");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115"
    "G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115G115");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116"
    "G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116G116");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117"
    "G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117G117");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118"
    "G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118G118");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119"
    "G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119G119");
  copy_to_address(
    (char **)&RSA_KEY_1,
    "G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120"
    "G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120G120");
```
After This the malware will call 2 functions to remove the concatened random string <br/><br/>
```c 
v2 = length_of_good_data((_BYTE *)def, (_BYTE *)RSA_KEY_1); // look where ||| start 
  keep_good_data(RSA_KEY_1, 1, (int)(v2 - 1), (char **)&RSA_KEY_1); // removing everything from ||| to the end 
```
It will do this 2 more times </br>
Public keys : <br/>
key1 : <br/>```8218573558423868576763286162417727488729356553874144436243558385082013292018314269999051321143121835
1515869551667585525921751268860153332622085268097015158687030691773886056780852269841267506558244411
03484117901192362044107373706299647832760503989379610949620903289961076922047235709569442148351776390771045819406380
727053579573045429371687056037657759416374532634792426441798055715624726414878656648
97932057208863804097317380182557626120092371160971366025152017122881832224591456521412041436352424715545408606242333
6157248028947150603748999307483486931045687820834658160053550185302437313510217654141746100718072807:65537 ```<br/>
key2 :<br/>```4372050014365306731665318876644049576237295145980325470433244938064878163614460265772360030641667318
1918633158563712416544618578249307294895202624079580191874460024499933472381883027218220456554995247
65158281214745718421265965989442504562394836294548216033955590900254939392369170497228950606445248805833582659669548
453902496538789520516235779898350051755771122652473634583693017585978107350613046507
46286697306922310714255768031863446183870422616732285912784282786501377105470022873925357301968061494307039417299358"
802372691417937010589796477887985234705396188080181574217253421725831596987526612984119150272153433:65537 ```<br/>
key3 :<br/>```1126048008758310315572083729673247664750217706440310384210425629270517516681654119401821441652672859
2250885693346405631902078278799322170358825905256814075226004951445616760965330764671293592279229722
22160196743305607106649317796986454753459601233200635881921575473627110125132446168309888011818714113680056574527396
080037359532723152575957056539345287927867505218040809140490765656786310534017742779
31993947586429667718985223045665309095957294692309771103410629132017241288155296515121849066713729856729622717014843
95040133896425327007320261010843739806058098358668173017378730321830022707681310903828104524796878143:65537```<br/>
We can notice that it's using a 65537 as exponent 

<br/>
This is the part where the malware will Create the data what will replace the name of the files after encryption 

```c 
copy(
    (volatile signed __int32 *)&email,
    (signed __int32)"vipasana4@aol.com|||KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK"
                    "KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK");// 
  // 
  // 
  // 
  v5 = length_of_good_data((_BYTE *)def, (_BYTE *)email);
  keep_good_data(email, 1, (int)(v5 - 1), (char **)&email);
  *(double *)&time_date = sub_409BB0();
  sub_40A7E8(v7, (char **)&v65, time_date, time_date >> 32);
  copy((volatile signed __int32 *)&::time_date, v65);
  copy((volatile signed __int32 *)&CL_str, (signed __int32)"CL 1.2.0.0");// 
  ```
the name of files after encryption will contain email "vipasana4@aol.com" , <b>the Time and date</b> when the file were crypted and the string <b>"CL 1.2.0.0"</b> and (another random generated string we will see it later ) <br/>
# Persistence
Now to the persistence part , The malware will try to copy itself to C:\Program Files (x86) and rerun the malware from there and kill the current process  <br/>
it's using the API <b>shellexecuteA<b/> to Create the new process then killing the current one with <b>OpenProcess</b> ,<b>TerminateProcess</b> in function <b>sub_437FA4</b>
<img src="shell.jpeg">

the new process will redo all the previous operations but it will check its emplacement this one its in "C:\Progam Files (x86)" so it will pass the creation of new process and  try to add new Key in the registry in <b>HKEY_LOCAL_MACHINE\\software\\microsoft\\windows\\currentversion\\run</b> using the APIS <b>RegCreateKeyExA , RegSetValueExA</b>, this tells us that anytime the computer starts it will start the malware on any user , so  it will not just encrypt the current user files , All users will loose their files .

# Generation of some keys that will be used in encryption 
The malware will generate 2048 alphanum caracters based on an internal state that gets modified by checking the speed of Program, looks like its creating some sort of custom pseudo random Number generator <br/>
```c
do
  {// generating 2048 caracter , 
  // 
    checking_for_speed_of_program();
    if ( Generating(2u) )
    {
      if ( Generating(2u) )
      {
        checking_for_speed_of_program(); // 
        v34 = Generating(0x1Au);
        LOBYTE(v34) = v34 + 65;
        copy_generated_caracter_0(v35, v34, (char **)&v45);
        sub_407EE4(v36, &v46, v45);
        copy_to_address((char **)&GENERATED_2048, v46);
      }
      else
      {
        checking_for_speed_of_program();
        v32 = Generating(0x1Au);
        LOBYTE(v32) = v32 + 65;
        copy_generated_caracter_0(v33, v32, &v47);
        copy_to_address((char **)&GENERATED_2048, v47);
      }
    }
    else
    {
      checking_for_speed_of_program();
      v31 = Generating(0xAu);
      copy_generated_caracter(v31, &v48);
      copy_to_address((char **)&GENERATED_2048, v48);
    }
    ++v30;
  }
  while ( v30 != 2049 );// // end generation
```
Then it will generate another 20 caracters uses the same random generation technique 
```c 
do
  {// generating 20 caracter 
  // 
    checking_for_speed_of_program();// changing an internal state for generating the next caracter
    v38 = Generating(0xAu);
    copy_generated_caracter(v38, &v44);
    copy_to_address((char **)&state_20_caracters, v44);
    ++v37;
  }
  while ( v37 != 21 );// End Genrating
  ```

